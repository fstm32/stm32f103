/*********************************************************************************************************
* 模块名称：SendDataToHost.c
* 摘    要：SendDataToHost模块
* 当前版本：1.0.0
* 作    者：SZLY(COPYRIGHT 2018 - 2020 SZLY. All rights reserved.)
* 完成日期：2020年01月01日 
* 内    容：
* 注    意：                                                                  
**********************************************************************************************************
* 取代版本：
* 作    者：
* 完成日期：
* 修改内容：
* 修改文件：
*********************************************************************************************************/

/*********************************************************************************************************
*                                              包含头文件
*********************************************************************************************************/
#include "SendDataToHost.h"
#include "PackUnpack.h"
#include "UART1.h"

/*********************************************************************************************************
*                                              宏定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              枚举结构体定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部变量
*********************************************************************************************************/
 
/*********************************************************************************************************
*                                              内部函数声明
*********************************************************************************************************/
static  void  SendPackToHost(StructPackType* pPackSent);  //打包数据，并将数据发送到主机

/*********************************************************************************************************
*                                              内部函数实现
*********************************************************************************************************/
/*********************************************************************************************************
* 函数名称：SendPackToHost
* 函数功能：打包数据，并将数据发送到主机
* 输入参数：pPackSent，指向结构体变量的地址
* 输出参数：void
* 返 回 值：void
* 创建日期：2018年01月01日
* 注    意：
*********************************************************************************************************/
static  void  SendPackToHost(StructPackType* pPackSent)
{
  u8  packValid = 0;  //打包正确标志位，默认值为0

  packValid = PackData(pPackSent);  //打包数据
  
  if(0 < packValid)                 //如果打包正确
  {
    WriteUART1((u8*)pPackSent, 10); //写数据到串口
  }
}

/*********************************************************************************************************
*                                              API函数实现
*********************************************************************************************************/
/*********************************************************************************************************
* 函数名称：InitSendDataToHost
* 函数功能：初始化SendDataToHost模块 
* 输入参数：void
* 输出参数：void
* 返 回 值：void
* 创建日期：2018年01月01日
* 注    意：
*********************************************************************************************************/
void  InitSendDataToHost(void)
{
  
}

/*********************************************************************************************************
* 函数名称：SendAckPack
* 函数功能：发送命令应答数据包到主机
* 输入参数：moduleId为模块ID，secondId为二级ID，ackMsg为应答消息
* 输出参数：void
* 返 回 值：void
* 创建日期：2018年01月01日
* 注    意：
*********************************************************************************************************/
void SendAckPack(u8 moduleId, u8 secondId, u8 ackMsg)
{
  StructPackType pt;  //包结构体变量

  pt.packModuleId = MODULE_SYS;   //系统信息模块的模块ID
  pt.packSecondId = DAT_CMD_ACK;  //系统信息模块的二级ID
  pt.arrData[0] = moduleId; //模块ID       
  pt.arrData[1] = secondId; //二级ID
  pt.arrData[2] = ackMsg;   //应答消息
  pt.arrData[3] = 0;  //保留
  pt.arrData[4] = 0;  //保留
  pt.arrData[5] = 0;  //保留

  SendPackToHost(&pt);//打包数据，并将数据发送到主机
}

/*********************************************************************************************************
* 函数名称：SendWaveToHost
* 函数功能：发送打包好的波形数据包到主机，一次性发送5个点
* 输入参数：pWaveData-波形数据存放的地址，每个波形点取值范围为0～255
* 输出参数：void
* 返 回 值：void
* 创建日期：2018年01月01日
* 注    意：
*********************************************************************************************************/
void  SendWaveToHost(u8* pWaveData)
{
  StructPackType  pt; //包结构体变量
  
  pt.packModuleId = MODULE_WAVE;    //wave模块的模块ID
  pt.packSecondId = DAT_WAVE_WDATA; //wave模块的二级ID
  pt.arrData[0] = pWaveData[0]; //波形数据1
  pt.arrData[1] = pWaveData[1]; //波形数据2
  pt.arrData[2] = pWaveData[2]; //波形数据3
  pt.arrData[3] = pWaveData[3]; //波形数据4
  pt.arrData[4] = pWaveData[4]; //波形数据5
  pt.arrData[5] = 0;  //保留

  SendPackToHost(&pt);  //打包数据，并将数据发送到主机
}
